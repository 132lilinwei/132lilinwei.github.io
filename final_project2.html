<html>
<head>
</head>
<body>
<canvas id="canvas_id" width="500" height="500"></canvas>
<style>
div.absolute {
    position: absolute;
    top: 20px;
    left: 920px;
    width: 400px;
    height: 400px;
    border: 3px solid #73AD21;
}
</style>
<div class="absolute">
<h1>How to play</h1>
<p>1.Typing corresponding letters to shoot down the letter asteroids.</p>
<p>2.Using arrow keys to move the plane.</p>
<p>3.You lose when crash.</p>
</div>
<script src="https://code.jquery.com/jquery-2.1.0.js"> </script>

<script>
var myColor={
0:'#00FF00',
1:'#FF0000',
2:'#FF0033',
3:'#CC00CC',
4:'#FF6633',
5:'#66FF00',
6:'#FF66FF',
7:'#CCFF00',
8:'#00FFCC'
}
canvas=document.getElementById("canvas_id");
width=canvas.width;
height=canvas.height;
ctx=canvas.getContext("2d");
$(canvas).css({
	position:"absolute",
	left:400,
	top:0
})

var Letter=function(x,xSpeed,ySpeed,content){
	this.x=x;
	this.y=0;
	this.xSpeed=xSpeed;
	this.ySpeed=ySpeed;
	this.content=content;
	this.death=false;
	this.color=myColor[Math.floor(Math.random()*9)];
	this.predator;
	
}

Letter.prototype.move=function(){
	this.x=this.x+this.xSpeed;
	this.y=this.y+this.ySpeed;
	if (this.x+25>=width){
		this.x=width*2-50-this.x;
		this.xSpeed=0-this.xSpeed;
	}
	if (this.x<=0){
		this.x=0-this.x;
		this.xSpeed=0-this.xSpeed;
	}
	if (this.y>=height) {
		delete bullets[this.predator];
		delete this;
		return;
		
	}
}

Letter.prototype.draw=function(){
	ctx.font = '25px Impact';
    ctx.fillStyle = this.color;
	ctx.strokeStyle = this.color;
	ctx.textAlign="left";
	ctx.textBaseline = 'top';
	ctx.fillText( this.content, this.x , this.y);
	ctx.strokeRect(this.x,this.y,25,25);
}


var letters=[];

var addnew=function(number,speedrange){
	for(var j=0;j<number;j++){
		q=Math.floor(Math.random()*26);
		var newletter= String.fromCharCode(65 + q);
		var xPosition=Math.floor(Math.random()*width);
		var xxSpeed=Math.random()*4-2;
		letters.push(new Letter(xPosition,xxSpeed,speedrange,newletter));
	}
}






gameover=function(){
	clearInterval(myInterval);
	alert("Game Over");

}



var Plane=function(){
	this.x=width/2;
	this.size=15;
	this.y=height-this.size;
}

Plane.prototype.move=function(direction){
	if (direction==37 && this.x>=this.size+1) this.x-=2;
	if (direction==38 && this.y>=this.size+1) this.y-=2;
	if (direction==39 && this.x<=width-this.size-1) this.x+=2;
	if (direction==40 && this.y<=height-this.size-1) this.y+=2;
}

Plane.prototype.draw=function(){
	ctx.strokeStyle="#FFFAF0";
	ctx.strokeRect(this.x-this.size,this.y-this.size,this.size*2,this.size*2);
	ctx.beginPath();
	ctx.arc(this.x,this.y,this.size/2,90,Math.PI,true);
	ctx.fillStyle="#FFFAF0";
	ctx.fill();
}

Plane.prototype.ifCrashed=function(){
	for (var i=0;i<letters.length;i++)
		if(letters[i]!=undefined)
		if(((letters[i].x>=this.x-this.size-25) && (letters[i].x<=this.x+this.size))&&((letters[i].y+25>=this.y-this.size) && (letters[i].y<=this.y+this.size))) gameover();
}





var Bullet=function(x,y,target){
	this.x=x;
	this.y=y;
	this.speed=3;
	this.target=target;
}
Bullet.prototype.move=function(){
	if(letters[this.target].x-this.x>0){
		this.y=this.y+Math.sin(Math.atan((letters[this.target].y-this.y)/(letters[this.target].x-this.x)))*this.speed;
		this.x=this.x+Math.cos(Math.atan((letters[this.target].y-this.y)/(letters[this.target].x-this.x)))*this.speed;
	}else {
		this.y=this.y-(Math.sin(Math.atan((letters[this.target].y-this.y)/(letters[this.target].x-this.x)))*this.speed);
		this.x=this.x-(Math.cos(Math.atan((letters[this.target].y-this.y)/(letters[this.target].x-this.x)))*this.speed);
	}

}

Bullet.prototype.draw=function(){
	fillStyle="#FFDEAD";
	ctx.beginPath();
	ctx.arc(this.x,this.y,5,0,Math.PI*2,false);
	ctx.fill();
}

Bullet.prototype.ifShot=function(){
	if((this.x>=letters[this.target].x-5 && this.x<=letters[this.target].x+25)&&(this.y>=letters[this.target].y-5 && this.y<=letters[this.target].y+25)){
		return true;
	}
	else return false;
}







var drawscore=function(){
	ctx.font="small-caps 30px Arial";
	ctx.fillStyle="turquoise";
	ctx.textBaseline="top";
	ctx.textAlign="left";
	ctx.fillText("Score: "+ score,0,0);
}

var drawlevel=function(){
	ctx.font="small-caps 30px Arial";
	ctx.fillStyle="turquoise";
	ctx.textBaseline="top";
	ctx.textAlign="center";
	ctx.fillText("Level: "+ level,width/2,0);
}
var drawtime=function(time){
	ctx.font="small-caps 30px Arial";
	ctx.fillStyle="turquoise";
	ctx.textBaseline="top";
	ctx.textAlign="right";
	ctx.fillText("Time: "+time,width,0);
}





var background=document.createElement('img');
background.src='http://scienceblogs.com/startswithabang/files/2011/10/normal_Star-field-near-M31.jpeg';
var prepare=function(){
	ctx.clearRect(0,0,width,height);
	ctx.drawImage(background,0,0,width*3,height*3,0,0,width,height);
}


var map=[]; 
var time=0;
var bullets=[];
var i=100,j=0,score=0,keys=0,oo=0;
var myplane=new Plane;
var jletters=1;
var level=1,waves=0;
var myInterval=setInterval(function(){
	prepare();
	for(keys=65;keys<=90;keys++){
		if (map[keys]===true){
			for(oo=0;oo<letters.length;oo++) if(letters[oo]!=undefined && letters[oo].death===false){
				if (letters[oo].content===String.fromCharCode(keys)){
					bullets.push(new Bullet(myplane.x,myplane.y,oo));
					letters[oo].death=true;
					letters[oo].predator=bullets.length-1;
				}
			}
		}
	}
	for(keys=37;keys<=40;keys++){
		if(map[keys]===true) myplane.move(keys);
	}
	myplane.draw();

	for(var iBullet=0;iBullet<=bullets.length;iBullet++) if(bullets[iBullet]!=undefined){
		bullets[iBullet].move();
		bullets[iBullet].draw();
		if(bullets[iBullet].ifShot()){
			delete letters[bullets[iBullet].target];
			delete bullets[iBullet];
			
			score++;
		}
	}


	if(i===100){
		waves++;
		if(waves>3 && level<12){
			waves=1;
			level++;
			jletters++;
		}
		j=jletters;
		i=0;
	}
	if (j>0&&(i%10===0)) {
		addnew(1,level/5);
		j--;
	}
	i++;
	for (var k=0;k<letters.length;k++) if(letters[k]!=undefined){
		letters[k].move();
		letters[k].draw();
	}
	
	myplane.ifCrashed();
	
	drawlevel();
	drawscore();
	drawtime(time.toFixed(2));
	time+=0.03;
},30);


$("body").keydown(function(event){
	map[event.keyCode]=true;
});

$("body").keyup(function(event){
	map[event.keyCode]=false;
});









</script>
</body>
</html>






</script>